<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>테니스 클럽 관리 시스템</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 헤더 -->
        <header class="header">
            <div class="header-content">
                <div class="header-top">
                    <div class="version-info">
                        <span class="version-label">v</span>
                        <span class="version-number" id="versionNumber" onclick="openVersionModal()" style="cursor: pointer; text-decoration: underline;" title="버전 수정">1.0.0</span>
                    </div>
                    <h1><i class="fas fa-tennis-ball"></i> Aqua Tennis Club</h1>
                </div>
                <nav class="nav-tabs">
                    <button class="nav-tab active" data-tab="reservations">
                        <i class="fas fa-calendar-alt"></i> 예약관리
                    </button>
                    <button class="nav-tab" data-tab="members">
                        <i class="fas fa-users"></i> 회원관리
                    </button>
                    <button class="nav-tab" data-tab="courts" style="display: none;">
                        <i class="fas fa-map-marker-alt"></i> 코트관리
                    </button>
                    <button class="nav-tab" data-tab="balls">
                        <i class="fas fa-tennis-ball"></i> 볼관리
                    </button>
                    <button class="nav-tab" data-tab="ball-usage">
                        <i class="fas fa-history"></i> 볼사용기록
                    </button>
                </nav>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">
            <!-- 회원관리 섹션 -->
            <section id="members" class="tab-content">
                <div class="section-header">
                    <h2>회원 관리</h2>
                    <div class="header-buttons">
                        <button class="btn btn-primary" onclick="openMemberModal()">
                            <i class="fas fa-plus"></i> 새 회원 추가
                        </button>
                        <button class="btn btn-secondary" onclick="batchUpdateMembers()" style="margin-left: 10px; display: none;">
                            <i class="fas fa-sync"></i> 회원 일괄 업데이트
                        </button>
                    </div>
                </div>
                <div class="search-bar">
                    <input type="text" id="memberSearch" placeholder="예약조, 코트번호, 회원명으로 검색...">
                    <button class="btn btn-secondary" onclick="searchMembers()">
                        <i class="fas fa-search"></i> 검색
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="membersTable">
                        <thead>
                            <tr>
                                <th>예약조</th>
                                <th>코트번호</th>
                                <th>닉네임</th>
                                <th>이름</th>
                                <th>핸드폰번호</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- 동적으로 생성됨 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 코트관리 섹션 -->
            <section id="courts" class="tab-content">
                <div class="section-header">
                    <h2>코트 관리</h2>
                    <button class="btn btn-primary" onclick="openCourtModal()">
                        <i class="fas fa-plus"></i> 새 코트 추가
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table" id="courtsTable">
                        <thead>
                            <tr>
                                <th>코트번호</th>
                                <th>코트명</th>
                                <th>위치</th>
                                <th>표면타입</th>
                                <th>실내/실외</th>
                                <th>시간당요금</th>
                                <th>상태</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="courtsTableBody">
                            <!-- 동적으로 생성됨 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 예약관리 섹션 -->
            <section id="reservations" class="tab-content active">
                <div class="section-header">
                    <h2>예약 관리</h2>
                    <div class="header-buttons">
                        <button class="btn btn-primary" onclick="openReservationModal()">
                            <i class="fas fa-plus"></i> 새 예약 추가
                        </button>
                        <button class="btn btn-secondary" onclick="setupNextWeekReservations()">
                            <i class="fas fa-calendar-week"></i> 차주 예약세팅
                        </button>
                    </div>
                </div>
                <div class="filter-bar">
                    <input type="date" id="reservationDateFilter" onchange="filterReservations()">
                    <select id="courtFilter" onchange="filterReservations()">
                        <option value="">모든 코트</option>
                    </select>
                    <select id="statusFilter" onchange="filterReservations()">
                        <option value="">모든 상태</option>
                        <option value="pending">예약전</option>
                        <option value="success">성공</option>
                        <option value="failed">실패</option>
                        <option value="cancelled">취소</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="data-table" id="reservationsTable">
                        <thead>
                            <tr>
                                <th>예약일</th>
                                <th>코트</th>
                                <th>회원명</th>
                                <th>경기일</th>
                                <th>시간</th>
                                <th>상태</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                            <!-- 동적으로 생성됨 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 볼재고관리 섹션 -->
            <section id="balls" class="tab-content">
                <div class="section-header">
                    <h2>볼 재고 관리</h2>
                </div>
                <div class="table-container">
                    <table class="data-table" id="ballInventoryTable">
                        <thead>
                            <tr>
                                <th>재고ID</th>
                                <th>회원명</th>
                                <th>총 갯수</th>
                                <th>사용한 갯수</th>
                                <th>재고</th>
                                <th>메모</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="ballInventoryTableBody">
                            <!-- 동적으로 생성됨 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 볼사용기록 섹션 -->
            <section id="ball-usage" class="tab-content">
                <!-- 오늘 사용 갯수 입력 섹션 -->
                <div class="section-header">
                    <h2>볼 사용 기록</h2>
                    <div class="filter-bar">
                        <select id="memberFilter" onchange="filterBallUsage()">
                            <option value="">모든 회원</option>
                        </select>
                    </div>
                </div>
                
                <div class="usage-input-section">
                    <h3>오늘 사용 갯수 입력</h3>
                    <div class="table-container">
                        <table class="data-table" id="ballUsageInputTable">
                        <thead>
                            <tr>
                                <th>회원명</th>
                                <th>오늘 사용한 갯수</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                            <tbody id="ballUsageInputTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 사용 이력 섹션 -->
                <div class="usage-history-section">
                    <h3>사용 이력</h3>
                    <div class="filter-bar">
                        <input type="date" id="historyDateFilter" onchange="filterBallUsageHistory()">
                        <select id="historyMemberFilter" onchange="filterBallUsageHistory()">
                            <option value="">모든 회원</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="ballUsageHistoryTable">
                            <thead>
                                <tr>
                                    <th>회원명</th>
                                    <th>날짜</th>
                                    <th>사용 갯수</th>
                                    <th>메모</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="ballUsageHistoryTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 모달들 -->
    <!-- 회원 추가/수정 모달 -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberModalTitle">새 회원 추가</h3>
                <span class="close" onclick="closeMemberModal()">&times;</span>
            </div>
            <form id="memberForm">
                <div class="form-group">
                    <label for="memberCode">회원번호:</label>
                    <input type="text" id="memberCode" readonly>
                </div>
                <div class="form-group">
                    <label for="memberName">닉네임:</label>
                    <input type="text" id="memberName" required>
                </div>
                <div class="form-group">
                    <label for="reservationGroup">예약조:</label>
                    <select id="reservationGroup" required>
                        <option value="">선택하세요</option>
                        <option value="1주차">1주차</option>
                        <option value="2주차">2주차</option>
                        <option value="3주차">3주차</option>
                        <option value="4주차">4주차</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="courtNumber">코트번호:</label>
                    <select id="courtNumber">
                        <option value="">선택하세요</option>
                        <option value="1">1번</option>
                        <option value="2">2번</option>
                        <option value="3">3번</option>
                        <option value="4">4번</option>
                        <option value="5">5번</option>
                        <option value="6">6번</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="emergencyContactName">이름:</label>
                    <input type="text" id="emergencyContactName">
                </div>
                <div class="form-group">
                    <label for="emergencyContactPhone">핸드폰번호:</label>
                    <input type="tel" id="emergencyContactPhone">
                </div>
                <div class="form-group">
                    <label for="memberStatus">상태:</label>
                    <select id="memberStatus">
                        <option value="true">활성</option>
                        <option value="false">비활성</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="memberNotes">메모:</label>
                    <textarea id="memberNotes"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeMemberModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 코트 추가/수정 모달 -->
    <div id="courtModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="courtModalTitle">새 코트 추가</h3>
                <span class="close" onclick="closeCourtModal()">&times;</span>
            </div>
            <form id="courtForm">
                <div class="form-group">
                    <label for="courtNumber">코트번호:</label>
                    <input type="text" id="courtNumber" required>
                </div>
                <div class="form-group">
                    <label for="courtName">코트명:</label>
                    <input type="text" id="courtName" required>
                </div>
                <div class="form-group">
                    <label for="courtLocation">위치:</label>
                    <input type="text" id="courtLocation">
                </div>
                <div class="form-group">
                    <label for="surfaceType">표면 타입:</label>
                    <select id="surfaceType" required>
                        <option value="hard">하드코트</option>
                        <option value="clay">클레이코트</option>
                        <option value="grass">잔디코트</option>
                        <option value="synthetic">합성코트</option>
                        <option value="indoor_hard">실내하드코트</option>
                        <option value="indoor_clay">실내클레이코트</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="isIndoor">실내/실외:</label>
                    <select id="isIndoor">
                        <option value="false">실외</option>
                        <option value="true">실내</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lightingType">조명 타입:</label>
                    <select id="lightingType">
                        <option value="natural">자연광</option>
                        <option value="led">LED</option>
                        <option value="halogen">할로겐</option>
                        <option value="none">없음</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="courtSize">코트 크기:</label>
                    <select id="courtSize">
                        <option value="standard">표준</option>
                        <option value="mini">미니</option>
                        <option value="practice">연습용</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hourlyRate">시간당 요금:</label>
                    <input type="number" id="hourlyRate" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="peakHourRate">피크 시간 요금:</label>
                    <input type="number" id="peakHourRate" step="0.01">
                </div>
                <div class="form-group">
                    <label for="maxCapacity">최대 수용 인원:</label>
                    <input type="number" id="maxCapacity" min="1" max="8" value="4">
                </div>
                <div class="form-group">
                    <label for="courtNotes">메모:</label>
                    <textarea id="courtNotes"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCourtModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 예약 추가/수정 모달 -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="reservationModalTitle">새 예약 추가</h3>
                <span class="close" onclick="closeReservationModal()">&times;</span>
            </div>
            <form id="reservationForm">
                <div class="form-group">
                    <label for="reservationCode">예약번호:</label>
                    <input type="text" id="reservationCode" readonly>
                </div>
                <div class="form-group">
                    <label for="reservationMember">회원:</label>
                    <select id="reservationMember" required>
                        <option value="">회원을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reservationCourt">코트:</label>
                    <select id="reservationCourt" required>
                        <option value="">코트를 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reservationDate">예약일 (아침 7시 정각):</label>
                    <input type="date" id="reservationDate" required>
                </div>
                <div class="form-group">
                    <label for="gameDate">경기일:</label>
                    <input type="date" id="gameDate" readonly>
                </div>
                <div class="form-group">
                    <label for="startTime">시작 시간:</label>
                    <select id="startTime" required>
                        <option value="">시간을 선택하세요</option>
                        <option value="06:00">06:00</option>
                        <option value="08:00">08:00</option>
                        <option value="10:00">10:00</option>
                        <option value="12:00">12:00</option>
                        <option value="14:00">14:00</option>
                        <option value="16:00">16:00</option>
                        <option value="18:00">18:00</option>
                        <option value="20:00">20:00</option>
                        <option value="22:00">22:00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="guestCount">참가자 수:</label>
                    <input type="number" id="guestCount" min="1" max="8" value="4">
                </div>
                <div class="form-group">
                    <label for="specialRequests">특별 요청사항:</label>
                    <textarea id="specialRequests"></textarea>
                </div>
                <div class="form-group">
                    <label for="reservationStatus">상태:</label>
                    <select id="reservationStatus" required>
                        <option value="pending">예약전</option>
                        <option value="success">성공</option>
                        <option value="failed">실패</option>
                        <option value="cancelled">취소</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeReservationModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 볼재고관리 모달 -->
    <div id="ballInventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ballInventoryModalTitle">볼 재고 관리</h3>
                <span class="close" onclick="closeBallInventoryModal()">&times;</span>
            </div>
            <form id="ballInventoryForm">
                <div class="form-group">
                    <label for="inventoryMember">회원:</label>
                    <select id="inventoryMember" required>
                        <option value="">회원을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group" id="memberDisplayGroup" style="display: none;">
                    <label>회원:</label>
                    <input type="text" id="memberDisplay" readonly class="readonly-input">
                    <input type="hidden" id="inventoryMemberId">
                </div>
                <div class="form-group">
                    <label for="totalQuantity">총 갯수:</label>
                    <input type="number" id="totalQuantity" min="0" required>
                </div>
                <div class="form-group">
                    <label for="inventoryNotes">메모:</label>
                    <textarea id="inventoryNotes" placeholder="재고 관련 메모를 입력하세요"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeBallInventoryModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 볼 사용기록 추가/수정 모달 -->
    <div id="ballUsageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ballUsageModalTitle">새 사용기록 추가</h3>
                <span class="close" onclick="closeBallUsageModal()">&times;</span>
            </div>
            <form id="ballUsageForm">
                <div class="form-group">
                    <label for="usageMember">회원:</label>
                    <select id="usageMember" required onchange="updateAvailableQuantity()">
                        <option value="">회원을 선택하세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="usageDate">사용 날짜:</label>
                    <input type="date" id="usageDate" required>
                </div>
                <div class="form-group">
                    <label for="quantityUsed">사용한 갯수:</label>
                    <input type="number" id="quantityUsed" min="1" required>
                    <small class="form-text">사용 가능한 갯수: <span id="availableQuantityDisplay">0</span>개</small>
                </div>
                <div class="form-group">
                    <label for="usageNotes">메모:</label>
                    <textarea id="usageNotes" placeholder="사용 기록에 대한 메모를 입력하세요"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeBallUsageModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>


    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>로딩 중...</p>
        </div>
    </div>

    <!-- 버전 수정 모달 -->
    <div id="versionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>버전 수정</h3>
                <span class="close" onclick="closeVersionModal()">&times;</span>
            </div>
            <form id="versionForm">
                <div class="form-group">
                    <label for="versionMajor">Major:</label>
                    <input type="number" id="versionMajor" min="0" required>
                </div>
                <div class="form-group">
                    <label for="versionMinor">Minor:</label>
                    <input type="number" id="versionMinor" min="0" required>
                </div>
                <div class="form-group">
                    <label for="versionPatch">Patch:</label>
                    <input type="number" id="versionPatch" min="0" required>
                </div>
                <div class="form-group">
                    <label for="versionNotes">릴리즈 노트:</label>
                    <textarea id="versionNotes" placeholder="버전 변경 사항을 입력하세요"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" onclick="openVersionHistoryModal()">
                        <i class="fas fa-history"></i> 히스토리 보기
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeVersionModal()">취소</button>
                    <button type="submit" class="btn btn-primary">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 버전 히스토리 모달 -->
    <div id="versionHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>버전 히스토리</h3>
                <span class="close" onclick="closeVersionHistoryModal()">&times;</span>
            </div>
            <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>버전</th>
                            <th>상태</th>
                            <th>릴리즈 노트</th>
                            <th>생성일</th>
                            <th>생성자</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody id="versionHistoryTableBody">
                        <!-- 동적으로 생성됨 -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeVersionHistoryModal()">닫기</button>
            </div>
        </div>
    </div>

    <!-- 알림 메시지 -->
    <div id="notification" class="notification"></div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</body>
</html>

